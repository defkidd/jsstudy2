<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <script src="/static/jquery-3.6.0.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>
    <div id="id_disp"></div>

    <table border=1 id="id_tbl2">
        <tr>
            <td>col01 :</td>
            <td><input type="text" id="id_col01" name="id_col01" value="">
            </td>
        </tr>
        <tr>
            <td>col02 :</td>
            <td><input type="text" id="id_col02" name="id_col02" value="">
            </td>
        </tr>
        <tr>
            <td>col03 :</td>
            <td><input type="text" id="id_col03" name="id_col03" value="">
            </td>
        </tr>

        <tr>
            <td colspan="2"><input type="button" value="추가" id="id_insert">
                <input type="button" value="수정" id="id_update"> <input type="button" value="삭제" id="id_delete">
        </tr>
    </table>

    <script>
        var v_disp = document.querySelector("#id_disp")
        // 		var v_col01Btn=""
        var col01 = "";
        var col02 = "";
        var col03 = "";
        var v_insert = document.querySelector("#id_insert")
        var v_update = document.querySelector("#id_update")
        var v_delete = document.querySelector("#id_delete")
        var v_selectView = function () {
            $.ajax({
                async: false,
                type: "get",
                url: "selectAjax",
                dataType: "json",
                success: function (data) {
                    // 					  console.log(data)
                    var v_tbl = `<table border=1 id='tbl' >
				  	<tr><th>col01</th><th>col02</th><th>col03</th></tr><tbody>`;
                    for (var i = 0; i < data.length; i++) {
                        v_tbl += `<tr>
				  						<td><a class ="clickA" id="id_col01_${i}" href="">${data[i].col01}</a></td>
				  						<td>${data[i].col02}</td>
				  						<td>${data[i].col03}</td>
				  					  </tr>`;
                    }
                    v_tbl += `</tbody></table>`;
                    // 					v_disp.insertAdjacentHTML('afterend', v_tbl)
                    v_disp.innerHTML = v_tbl

                }

            });
        }
        v_selectView();

        v_insert.addEventListener("click", function () {
            col01 = document.querySelector("#id_col01").value
            col02 = document.querySelector("#id_col02").value
            col03 = document.querySelector("#id_col03").value
            async();
            // 				$.ajax({
            // 					  type:"POST",
            // 					  url: "insertAjax",
            // 					  dataType: "json",
            // 					  data : {
            // 						  'col01' : col01,
            // 						  'col02' : col02,
            // 						  'col03' : col03,

            // 					  },
            // 					  success: function(data){
            // 						  if (data.msg == "ok"){
            // 							  location.reload();
            // 						  } else {
            // 							  alert("등록실패")
            // 						  }
            // 					  }
            // 				});
            var form = new FormData();
            form.append('col01', col01);
            form.append('col02', col02);
            form.append('col03', col03);
            console.log(form.get('col01'))
            // 				axios.post("insertAjax",form)
            function async() {
                try {
                    const response = axios.post("insertAjax", {
                        data: {
                            col011: "" + col01 + "",
                            col021: "" + col02 + "",
                            col031: "" + col03 + ""
                        }
                    });
                    location.reload();
                } catch (error) {
                    alert("등록실패");
                }
            }


            // 				axios.post("insertAjax",{
            // 					  data : {
            // 						  col011 : ""+col01 +"", 
            // 						  col021 : ""+col02 +"", 
            // 						  col031 : ""+col03 +"" 
            // 					  }
            // 				}).then(function(response){
            // 					console.log(response.statusText)
            // 						location.reload();
            // 				}).catch(function(error) {
            // 					alert("등록실패")
            // 				 })

        });

        v_update.addEventListener("click", function () {
            col01 = document.querySelector("#id_col01").value
            col02 = document.querySelector("#id_col02").value
            col03 = document.querySelector("#id_col03").value
            $.ajax({
                type: "POST",
                url: "updateAjax",
                dataType: "json",
                data: {
                    'col01': col01,
                    'col02': col02,
                    'col03': col03,

                },
                success: function (data) {
                    if (data.msg == "ok") {
                        location.reload();
                    } else {
                        alert("등록실패")
                    }
                }
            });

        });

        v_delete.addEventListener("click", function () {
            var a = confirm("삭제?")
            if (!a) {
                return;
            }
            col01 = document.querySelector("#id_col01").value
            $.ajax({
                type: "POST",
                url: "deleteAjax",
                dataType: "json",
                data: {
                    'col01': col01,
                },
                success: function (data) {
                    if (data.msg == "ok") {
                        location.reload();
                    } else {
                        alert("등록실패")
                    }
                }
            });

        });


        var v_col01Btn = document.querySelectorAll(".clickA")
        // 		console.log(v_col01Btn)
        for (var i = 0; i < v_col01Btn.length; i++) {
            v_col01Btn[i].addEventListener("click", function (e) {
                e.preventDefault();
                // 				console.log(event.target.parentElement.parentElement.textContent)
                // 				console.log(event.target.parentElement.parentElement)
                // 				var number = event.target.parentElement.parentElement.textContent
                // 				var number = event.target.parentElement.parentElement
                var number = event.target.parentElement.parentElement.cells
                var arr = [].slice.call(number)
                // 				console.log(arr)
                for (var i = 0; i < arr.length; i++) {
                    document.querySelector("#id_col01").value = arr[0].textContent
                    document.querySelector("#id_col02").value = arr[1].textContent
                    document.querySelector("#id_col03").value = arr[2].textContent
                    // 					console.log(arr[i].textContent)

                }
                // 				console.log(typeof(number))
                // 				console.log(number)
                // 				console.log((number.split(" ")))


                // 				document.querySelector("#id_disp").appendChild(event.target.parentElement.parentElement);
            })
        }


    </script>
</body>

</html>